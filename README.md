# (IEEE TIFS) Attention-Based API Locating for Malware Techniques

This paper presents APILI, an innovative approach
to behavior-based malware analysis that utilizes deep learning
to locate the API calls corresponding to discovered malware
techniques in dynamic execution traces. APILI defines mul-
tiple attentions between API calls, resources, and techniques,
incorporating MITRE ATT&CK framework, adversary tactics,
techniques and procedures, through a neural network. We employ
fine-tuned BERT for arguments/resources embedding, SVD for
technique representation, and several design enhancements, in-
cluding layer structure and noise addition, to improve the locating
performance. To the best of our knowledge, this is the first
attempt to locate low-level API calls that correspond to high-
level malicious behaviors (that is, techniques). Our evaluation
demonstrates that APILI outperforms other traditional and
machine learning techniques in both technique discovery and
API locating. These results indicate the promising performance
of APILI, thus allowing it to reduce the analysis workload.

## Prediction:
1. Get the trace(report) file (.json) from Cuckoo Sandbox.
2. Make mist file via OperaPrediction/make_mist_ver_cuckoo_fixed.ipynb
3. Prediction via OperaPrediction/Predict.ipynb

## Training from sketch
Download Dataset / training code / ckp / result in paper 

https://1drv.ms/f/s!AmHd3ERrMbP0xdlAh4_FqMT-Uxs8Qg?e=rDiLxv

1. src/Config_bert.json,  modify the path for your location
2. src/train_supervised.py, cd to the src/ and use the command to training, "python train_supervised.py --gpu 0 --type bert"
3. args.freeze and args.cp are disuse for this version.

## Locating api call from predict techniques

1. You can extract attention values from the prediction by following the paper's instructions.
   
3. If you want to reproduce the results of the paper, please open issus and provide your university/laboratory/school email address
   
5. The current locating code is a beta version that can only reproduce the results presented in the paper.
   To handle unseen malware, modifications are needed to enable the code to function without retraining the model.

## Update

Done:
1. Upload dataset.csv in "Dataset" folder
2. Upload OPERA.mist file (OperaSetup_win7.mist) in "OperaPrediction" folder, which is recorded by Cuckoo sandbox and transfer json file in to mist file.
3. Upload inference OPERA file in "OperaPrediction" folder, which inclued load BERT, Autoencoder and APILI weights, and predict technique of OPERA.mist file. OPERA is out-of-list in our training dataset. (Predict.ipynb)
4. Upload Autoencoder weight in "AutoEncoder" folder. (ep_162_AE_loss_0.436_val_0.459)
5. Upload Mitre Representation files in "MitreRepresentation" folder.
6. Upload Mitre other files in "Tools" folder.
7. Upload Model check point in "CKP" folder. (epoch_175_L_0.437_P_0.936_R_0.949_F0.942)
8. Upload locating example code for Table X(Noise layer 1), this code could change noise layer from 0 to 2 to reproduce result of Table X
